<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinAttendance - Workforce Monitoring Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-background-pattern"></div>
            <div class="header-content">
                <div class="logo-section">
                    <div class="winwire-brand">
                        <span class="brand-win">Win</span><span class="brand-wire">Wire</span>
                    </div>
                    <p class="subtitle">AI-Powered Workforce Monitoring & Late-Stay Tracking</p>
                </div>
                <div class="header-actions">
                    <div class="header-right-section">
                        <div class="winattendance-text">
                            <span class="brand-win">Win</span><span class="brand-attendance">Attendance</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showPage('dashboard')" data-page="dashboard">
                <span>üìä</span> Dashboard
            </button>
            <button class="nav-tab" onclick="showPage('attendance')" data-page="attendance">
                <span>üìã</span> Attendance
            </button>
            <button class="nav-tab" onclick="showPage('late-stay')" data-page="late-stay">
                <span>üåô</span> Late Stay
            </button>
            <button class="nav-tab" onclick="showPage('reports')" data-page="reports">
                <span>üìà</span> Reports
            </button>
            <div class="date-execute-section" id="dateExecuteSection">
                <div class="date-selector">
                    <label for="datePicker" class="date-label">üìÖ</label>
                    <input type="date" id="datePicker" value="">
                </div>
                <button class="btn-execute" onclick="loadDashboard()">
                    <span>‚ñ∂</span> Execute
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Dashboard/Overview Page -->
            <div id="page-dashboard" class="page-content active">
                <!-- Stats Cards -->
                <section class="stats-grid">
                    <div class="stat-card stat-primary">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-content">
                            <h3>Total Present</h3>
                            <p class="stat-value" id="totalPresent">-</p>
                            <span class="stat-label">Today</span>
                        </div>
                    </div>

                    <div class="stat-card stat-warning">
                        <div class="stat-icon">üåô</div>
                        <div class="stat-content">
                            <h3>Late Stay</h3>
                            <p class="stat-value" id="lateStayCount">-</p>
                            <span class="stat-label">After 8:00 PM</span>
                        </div>
                    </div>

                    <div class="stat-card stat-danger">
                        <div class="stat-icon">üë©</div>
                        <div class="stat-content">
                            <h3>Women Late Stay</h3>
                            <p class="stat-value" id="womenLateStay">-</p>
                            <span class="stat-label">Safety Compliance</span>
                        </div>
                    </div>

                    <div class="stat-card stat-success">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-content">
                            <h3>WFO Compliance</h3>
                            <p class="stat-value" id="wfoCompliance">-</p>
                            <span class="stat-label">% Present (WFO)</span>
                        </div>
                    </div>

                    <div class="stat-card stat-info">
                        <div class="stat-icon">üè†</div>
                        <div class="stat-content">
                            <h3>WFH Compliance</h3>
                            <p class="stat-value" id="wfhCompliance">-</p>
                            <span class="stat-label">% Present (WFH)</span>
                        </div>
                    </div>
                </section>

                <!-- Charts Section -->
                <section class="charts-section">
                    <div class="chart-card">
                        <h2>Attendance Overview</h2>
                        <div class="chart-container">
                            <canvas id="attendanceChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h2>Late Stay by Gender</h2>
                        <div class="chart-container chart-container-small">
                            <canvas id="genderChart"></canvas>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Attendance Page -->
            <div id="page-attendance" class="page-content">
                <div class="page-header">
                    <h1>üìã Attendance Records</h1>
                    <p>View and manage employee attendance records</p>
                </div>
                <div class="table-card">
                    <div class="table-header">
                        <h2>Today's Attendance</h2>
                        <div class="table-actions">
                            <input type="text" id="attendanceSearch" class="search-input" placeholder="Search by name or ID..." onkeyup="filterAttendanceTable()">
                            <select id="statusFilter" class="filter-select" onchange="filterAttendanceTable()">
                                <option value="">All Status</option>
                                <option value="On Time">On Time</option>
                                <option value="Late Arrival">Late Arrival</option>
                                <option value="Late Stay">Late Stay</option>
                            </select>
                            <button class="btn-filter" onclick="clearFilter()">Clear</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="attendanceTable">
                            <thead>
                                <tr>
                                    <th class="sortable" onclick="sortTable('attendanceTable', 0)">
                                        Employee ID <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('attendanceTable', 1)">
                                        Name <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('attendanceTable', 2)">
                                        Check-in <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('attendanceTable', 3)">
                                        Check-out <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('attendanceTable', 4)">
                                        Hours <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <tr>
                                    <td colspan="6" class="loading">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Late Stay Page -->
            <div id="page-late-stay" class="page-content">
                <div class="page-header">
                    <h1>üåô Late Stay Monitoring</h1>
                    <p>Track employees staying after 8:00 PM, with special focus on women employee safety</p>
                </div>
                <div class="table-card">
                    <div class="table-header">
                        <h2>Late Stay Employees (After 8:00 PM)</h2>
                        <div class="table-actions">
                            <input type="text" id="lateStaySearch" class="search-input" placeholder="Search by name or ID..." onkeyup="filterLateStayTable()">
                            <select id="genderFilter" class="filter-select" onchange="filterLateStayTable()">
                                <option value="">All Gender</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                            <select id="projectFilter" class="filter-select" onchange="filterLateStayTable()">
                                <option value="">All Projects</option>
                                <option value="P101">P101</option>
                                <option value="P102">P102</option>
                            </select>
                            <button class="btn-filter" onclick="clearLateStayFilter()">Clear</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="lateStayTable">
                            <thead>
                                <tr>
                                    <th class="sortable" onclick="sortTable('lateStayTable', 0)">
                                        Employee ID <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('lateStayTable', 1)">
                                        Name <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('lateStayTable', 2)">
                                        Gender <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('lateStayTable', 3)">
                                        Check-out <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('lateStayTable', 4)">
                                        Project <span class="sort-icon">‚áÖ</span>
                                    </th>
                                    <th class="sortable" onclick="sortTable('lateStayTable', 5)">
                                        Office <span class="sort-icon">‚áÖ</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="lateStayTableBody">
                                <tr>
                                    <td colspan="6" class="loading">Loading...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Reports Page -->
            <div id="page-reports" class="page-content">
                <div class="page-header">
                    <div class="page-header-content">
                        <div>
                            <h1>üìà Reports & Analytics</h1>
                            <p>Work balance analysis, WFO compliance, and project insights</p>
                        </div>
                        <button class="btn-download-csv" onclick="downloadReportsCSV()" title="Download Reports as CSV">
                            <span>üì•</span> Download CSV
                        </button>
                    </div>
                </div>
                
                <!-- WFO/WFH Compliance Summary Card -->
                <section class="compliance-summary-section">
                    <div class="compliance-summary-card" id="complianceSummaryCard">
                        <h2>üìã WFO/WFH Compliance Summary</h2>
                        <div class="compliance-stats-grid">
                            <div class="compliance-stat">
                                <span class="compliance-label">Total Employees</span>
                                <span class="compliance-value" id="complianceTotalEmployees">-</span>
                            </div>
                            <div class="compliance-stat">
                                <span class="compliance-label">Present Today</span>
                                <span class="compliance-value" id="compliancePresent">-</span>
                            </div>
                            <div class="compliance-stat">
                                <span class="compliance-label">WFO Compliance</span>
                                <span class="compliance-value wfo-value" id="complianceWFO">-</span>
                            </div>
                            <div class="compliance-stat">
                                <span class="compliance-label">WFH Compliance</span>
                                <span class="compliance-value wfh-value" id="complianceWFH">-</span>
                            </div>
                            <div class="compliance-stat">
                                <span class="compliance-label">Overall Status</span>
                                <span class="compliance-value status-value" id="complianceStatus">-</span>
                            </div>
                        </div>
                    </div>
                </section>
                
                <section class="project-section">
                    <h2>üìä Project Work Balance</h2>
                    <div class="project-cards" id="projectCards">
                        <!-- Project cards will be dynamically loaded -->
                    </div>
                </section>
            </div>
        </main>

        <!-- Chatbot Widget (Global - Available on All Tabs) -->
        <div class="chat-widget" id="chatWidget">
            <button class="chat-button" id="chatToggle" aria-label="Open chat">
                <span class="chat-button-icon">ü§ñ</span>
                <span class="chat-button-pulse"></span>
            </button>
            <div class="chat-help-text">Need help ?</div>
            <div class="chat-panel" id="chatPanel" aria-hidden="true">
                <div class="chat-header">
                    <div class="chat-header-title">
                        <span class="chat-header-icon">ü§ñ</span>
                        <div>
                            <strong>WinWire AI Assistant</strong>
                            <div class="chat-header-status">‚óè Online</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:8px;align-items:center">
                        <button id="chatClear" class="chat-clear" title="Clear chat">üóëÔ∏è</button>
                        <button id="chatClose" class="chat-close">‚úñ</button>
                    </div>
                </div>
                <div class="chat-body">
                    <div class="chat-quick-questions" id="chatQuickQuestions">
                        <!-- Quick questions will be injected here based on active tab -->
                    </div>
                    <div class="chat-messages" id="chatMessages"></div>
                </div>
                <div class="chat-footer">
                    <input type="text" id="chatInput" placeholder="Ask a question or click a quick prompt" />
                    <button id="chatSend">Send</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/dashboard.js"></script>
</body>
</html>
